library(readstata13)  #imports .dta files from Stata 13 thru 15
library(tidyverse)
library(lubridate)
library(weights)
## -----------------------------------------------------------------------------
## directory paths
## -----------------------------------------------------------------------------
#this time we have a parent folder for the project (DetroitWaterShutoffs),
#and two subfolders for Data and Code
getwd()
## -----------------------------------------------------------------------------
## Get demographic data from the American Community Survey (via tidycensus)
## -----------------------------------------------------------------------------
# we can download data from the US Census Bureau using the tidycensus package
# tidycensus is a package that allows users to interface w/ Census Bureau data
# https://walker-data.com/tidycensus/
# data requests are made through the Census API
# an API is just a way of accessing data from within an app (e.g. RStudio)
# need to sign up for a free Census API Key:
#   http://api.census.gov/data/key_signup.html
### THE FOLLOWING CODE IS COMMENTED OUT AS SAMPLE CODE FOR REFERENCE
#
# # census_api_key("ENTER YOUR API KEY HERE")
#
# # initialize new data frame to store ACS data from API requests
# MI_acs_tract_10_17 <- data_frame()
#
# # set up a for loop for each year of data to access
# for (i in 2010:2017) {
#
#   # query ACS data from the census API for each year 2010-2017
#   acs <- get_acs(geography = "tract",
#                  state = "MI",
#                  variables = c(pop = "B01001_001",
#                                white_pop = "B01001H_001",
#                                hisp_pop = "B01001I_001",
#                                asian_pop = "B02001_005",
#                                black_pop = "B02001_003",
#                                male_pop = "B01001_002",
#                                medianinc = "B19013_001",
#                                med_age = "B01002_001",
#                                pov = "B17025_002"),
#                  year = i)
#
#   # transform data for later analysis and prep for join
#   acs <- acs %>%
#     select(-moe, -NAME) %>%
#     pivot_wider(names_from = variable, values_from = estimate) %>%
#     mutate(year = i,
#            whiteshare = 100 * (white_pop/pop),
#            hispshare = 100 * (hisp_pop/pop),
#            asianshare = 100 * (asian_pop/pop),
#            blackshare = 100 * (black_pop/pop),
#            maleshare = 100 * (male_pop/pop),
#            poverty_rate = 100 * (pov/pop),
#            black75 = as.numeric(blackshare >= 75),
#            inc_above_median = as.numeric(medianinc > 26884.59),
#            tractid = as.numeric(GEOID)) %>%
#     select(-GEOID)
#   print(i)
#
#   # append each year of data to a combined dataset
#   MI_acs_tract_10_17 <- MI_acs_tract_10_17 %>%
#     bind_rows(acs)
# }
#
# # save data frame
# saveRDS(MI_acs_tract_10_17, file = "Data/MI_acs_tract_10_17.rds")
### START HERE IN CLASS
#load ACS data
MI_acs_tract_10_17 <- readRDS("Data/MI_acs_tract_10_17.rds")
