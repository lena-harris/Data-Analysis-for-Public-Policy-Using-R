summarise(st_id = first(st_id),
n = n()) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
n_na = sum(`race_eth_NA`, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))   %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
n_na = sum(`race_eth_NA`, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))
n_na    = sum(`race_eth_NA`) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
n_na = sum(`race_eth_NA`, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))
n_na    = sum(`race_eth_NA`, na.rm = TRUE) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(fastDummies)
arrests_bds <- read_csv("microdata_BDS_inclass.csv", na = "")
arrests_las <- read_csv("microdata_LAS_inclass.csv", na = "")
str(arrests_bds, give.attr = FALSE)
str(arrests_las, give.attr = FALSE)
summary(arrests_bds$race)
summary(arrests_bds$ethnicity)
summary(arrests_las$las_race_key)
summary(arrests_las$hispanic_flag)
arrests_bds <- arrests_bds %>%
mutate(race = as.factor(race),
ethnicity = as.factor(ethnicity))
arrests_bds <- arrests_bds %>%
mutate(race = as.factor(race))
arrests_bds.clean <- arrests_bds %>%
mutate(race_clean = recode(race, "0" = "NA",
"Unknown" = "NA",
"Am Indian" = "Other" ) )%>%
mutate(race_clean = factor(race_clean,
levels = c("Black", "White", "Asian/Pacific Islander", "Other")))
arrests_bds <- arrests_bds %>%
mutate(ethnicity = as.factor(ethnicity))
arrests_bds.clean <- arrests_bds.clean %>%
mutate(ethnicity_clean = recode(ethnicity,
'0' = 'NA',
'Other' = 'Non-Hispanic')) %>%
mutate(ethnicity_clean = factor(ethnicity_clean,
levels = c('Hispanic', 'Non-Hispanic')))
arrests_bds.clean <- arrests_bds.clean %>%
mutate(race_clean_char = as.character(race_clean),
ethnicity_clean_char   = as.character(ethnicity_clean)) %>%
mutate(race_eth = ifelse(ethnicity_clean_char %in% "Hispanic",
ethnicity_clean_char,
race_clean_char) ) %>%
mutate(race_eth = as.factor(recode(race_eth,
"White" = "Non-Hispanic White",
"Black" = "Non-Hispanic Black"))) %>%
select(-race_clean_char, -ethnicity_clean_char)
arrests_las <- arrests_las %>%
mutate(race = as.factor(las_race_key),
ethnicity = as.factor(hispanic_flag) )
arrests_las.clean <- arrests_las %>%
mutate(race_clean = recode(las_race_key,
"Asian or Pacific Islander" = "Asian/Pacific Islander",
"Unknown" = "NA",
"Latino" = "Hispanic",
"White" = "Non-Hispanic White",
"Black" = "Non-Hispanic Black")) %>%
mutate(race_eth = ifelse(hispanic_flag %in% "Y", "Hispanic", race_clean)) %>%
mutate(race_eth = factor(race_eth, levels = c("Non-Hispanic Black",
"Hispanic",
"Non-Hispanic White",
"Asian/Pacific Islander",
"Other")))
arrests_bds.clean <- arrests_bds.clean %>% mutate(pd = "bds")
arrests_las.clean <- arrests_las.clean %>% mutate(pd = "las")
arrests.clean <- bind_rows(arrests_bds.clean, arrests_las.clean) %>%
mutate(pd = as.factor(pd),
st_id = as.factor(st_id),
loc2 = as.factor(loc2)) %>%
select(pd, race_eth, age, male, st_id, loc2, dismissal)
summary(arrests.clean)
#save(list="arrests.clean",
#    file = "C:\\Users\\philc\\OneDrive\\Desktop\\Spring
#          2024\\R\\Lectures\\Lecture4\\arrests.clean.RData")
table(arrests.clean$race_eth, useNA = "always")
prop.table(table(arrests.clean$race_eth, useNA = "always")) %>%
round(2) %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
rename(race_eth = Var1)
prop.table(table(arrests.clean$race_eth)) %>%
round(2) %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
rename(race_eth = Var1)
race_eth_stats <- arrests.clean %>%
group_by(race_eth) %>%
summarise(mean_age = mean(age, na.rm = TRUE),
share_male = mean(male, na.rm = TRUE),
dismissal_rate = mean(dismissal, na.rm = TRUE),
total_n = n(),
dismissal_n = n_distinct(dismissal, na.rm = TRUE))
print(race_eth_stats)
arrests.clean <- dummy_cols(arrests.clean, select_columns = "race_eth")
arrests.clean %>%
summarise(mean_black = mean(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
mean_hispanic = mean(`race_eth_Hispanic`, na.rm = TRUE),
mean_white = mean(`race_eth_Non-Hispanic White`, na.rm = TRUE),
mean_asianpi = mean(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
mean_other = mean(`race_eth_Other`, na.rm = TRUE))
arrests_stations <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE) )   %>%
arrange(desc(n))
knitr::kable(head(arrests_stations, n = 10))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))
n_na    = sum(`race_eth_NA`, na.rm = TRUE) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
View(arrests_stations_top)
View(arrests.clean)
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))
n_na    = sum(race_eth_NA, na.rm = TRUE) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))
n_na    = sum(race_eth_NA) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE))
n_na    = sum(race_eth_NA, na.rm = TRUE) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE))
n_na    = sum(`race_eth_NA`, na.rm = TRUE) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na))
knitr::kable(head(arrests_stations_top, n >= 50))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
knitr::kable(head(arrests_stations_top))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
knitr::kable(head(arrests_stations_top))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
knitr::kable(arrests_stations_top)
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
kable(arrests_stations_top)
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
knitr::kable(arrests_stations_top)
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(>= 50),
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh) %>%
summarise(n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50)
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh,
n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50)
knitr::kable(arrests_stations_top)
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh,
n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
arrange(ascending(share_bh))
?arrange
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh,
n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
arrange(share_bh)
knitr::kable(arrests_stations_top)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(fastDummies)
arrests_bds <- read_csv("microdata_BDS_inclass.csv", na = "")
arrests_las <- read_csv("microdata_LAS_inclass.csv", na = "")
str(arrests_bds, give.attr = FALSE)
str(arrests_las, give.attr = FALSE)
summary(arrests_bds$race)
summary(arrests_bds$ethnicity)
summary(arrests_las$las_race_key)
summary(arrests_las$hispanic_flag)
arrests_bds <- arrests_bds %>%
mutate(race = as.factor(race),
ethnicity = as.factor(ethnicity))
arrests_bds <- arrests_bds %>%
mutate(race = as.factor(race))
arrests_bds.clean <- arrests_bds %>%
mutate(race_clean = recode(race, "0" = "NA",
"Unknown" = "NA",
"Am Indian" = "Other" ) )%>%
mutate(race_clean = factor(race_clean,
levels = c("Black", "White", "Asian/Pacific Islander", "Other")))
arrests_bds <- arrests_bds %>%
mutate(ethnicity = as.factor(ethnicity))
arrests_bds.clean <- arrests_bds.clean %>%
mutate(ethnicity_clean = recode(ethnicity,
'0' = 'NA',
'Other' = 'Non-Hispanic')) %>%
mutate(ethnicity_clean = factor(ethnicity_clean,
levels = c('Hispanic', 'Non-Hispanic')))
arrests_bds.clean <- arrests_bds.clean %>%
mutate(race_clean_char = as.character(race_clean),
ethnicity_clean_char   = as.character(ethnicity_clean)) %>%
mutate(race_eth = ifelse(ethnicity_clean_char %in% "Hispanic",
ethnicity_clean_char,
race_clean_char) ) %>%
mutate(race_eth = as.factor(recode(race_eth,
"White" = "Non-Hispanic White",
"Black" = "Non-Hispanic Black"))) %>%
select(-race_clean_char, -ethnicity_clean_char)
arrests_las <- arrests_las %>%
mutate(race = as.factor(las_race_key),
ethnicity = as.factor(hispanic_flag) )
arrests_las.clean <- arrests_las %>%
mutate(race_clean = recode(las_race_key,
"Asian or Pacific Islander" = "Asian/Pacific Islander",
"Unknown" = "NA",
"Latino" = "Hispanic",
"White" = "Non-Hispanic White",
"Black" = "Non-Hispanic Black")) %>%
mutate(race_eth = ifelse(hispanic_flag %in% "Y", "Hispanic", race_clean)) %>%
mutate(race_eth = factor(race_eth, levels = c("Non-Hispanic Black",
"Hispanic",
"Non-Hispanic White",
"Asian/Pacific Islander",
"Other")))
arrests_bds.clean <- arrests_bds.clean %>% mutate(pd = "bds")
arrests_las.clean <- arrests_las.clean %>% mutate(pd = "las")
arrests.clean <- bind_rows(arrests_bds.clean, arrests_las.clean) %>%
mutate(pd = as.factor(pd),
st_id = as.factor(st_id),
loc2 = as.factor(loc2)) %>%
select(pd, race_eth, age, male, st_id, loc2, dismissal)
summary(arrests.clean)
#save(list="arrests.clean",
#    file = "C:\\Users\\philc\\OneDrive\\Desktop\\Spring
#          2024\\R\\Lectures\\Lecture4\\arrests.clean.RData")
##Commenting this out as it caused issues when knitting##
table(arrests.clean$race_eth, useNA = "always")
prop.table(table(arrests.clean$race_eth, useNA = "always")) %>%
round(2) %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
rename(race_eth = Var1)
prop.table(table(arrests.clean$race_eth)) %>%
round(2) %>%
as.data.frame() %>%
arrange(desc(Freq)) %>%
rename(race_eth = Var1)
race_eth_stats <- arrests.clean %>%
group_by(race_eth) %>%
summarise(mean_age = mean(age, na.rm = TRUE),
share_male = mean(male, na.rm = TRUE),
dismissal_rate = mean(dismissal, na.rm = TRUE),
total_n = n(),
dismissal_n = n_distinct(dismissal, na.rm = TRUE))
print(race_eth_stats)
arrests.clean <- dummy_cols(arrests.clean, select_columns = "race_eth")
arrests.clean %>%
summarise(mean_black = mean(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
mean_hispanic = mean(`race_eth_Hispanic`, na.rm = TRUE),
mean_white = mean(`race_eth_Non-Hispanic White`, na.rm = TRUE),
mean_asianpi = mean(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
mean_other = mean(`race_eth_Other`, na.rm = TRUE))
arrests_stations <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(race_eth_Other, na.rm = TRUE) )   %>%
arrange(desc(n))
knitr::kable(head(arrests_stations, n = 10))
arrests_stations_top <- arrests.clean %>%
group_by(loc2) %>%
summarise(st_id = first(st_id),
n = n(),
n_black = sum(`race_eth_Non-Hispanic Black`, na.rm = TRUE),
n_hisp  = sum(race_eth_Hispanic, na.rm = TRUE),
n_api   = sum(`race_eth_Asian/Pacific Islander`, na.rm = TRUE),
n_nhw   = sum(`race_eth_Non-Hispanic White`, na.rm = TRUE),
n_oth   = sum(`race_eth_Other`, na.rm = TRUE),
n_na    = sum(`race_eth_NA`, na.rm = TRUE)) %>%
mutate(n_bh = n_black + n_hisp,
new = 1-n_bh,
n_bh = sum(n_bh, na.rm = TRUE),
share_bh = n_bh / (n - n_na)) %>%
filter(n >= 50) %>%
arrange(share_bh)
knitr::kable(arrests_stations_top)
